<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>p5.js Transparent Black Overlay</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>

<script>
  let video;
  let bgVideo;

  function setup() {
    createCanvas(windowWidth, windowHeight);

    // Load and start the background video
    bgVideo = createVideo('background.mp4', () => {
      bgVideo.loop();
      bgVideo.hide(); // Hide the default video element
    });

    // Access the front camera feed
    video = createCapture({
      video: {
        facingMode: { ideal: "environment" }
      }
    });
    video.size(width, height); // Match video to canvas size
    video.hide(); // Hide the default video element
  }

  function draw() {
    // Draw the background video on the canvas first
    image(bgVideo, 0, 0, width, height);

    // Process the live video feed pixels to make black areas transparent
    video.loadPixels();
    for (let y = 0; y < video.height; y++) {
      for (let x = 0; x < video.width; x++) {
        const index = (x + y * video.width) * 4;
        const r = video.pixels[index];
        const g = video.pixels[index + 1];
        const b = video.pixels[index + 2];

        // Check if pixel is close to black
        const threshold = 50;
        if (r < threshold && g < threshold && b < threshold) {
          video.pixels[index + 3] = 0; // Make black pixel fully transparent
        }
      }
    }
    video.updatePixels(); // Apply pixel changes to the video feed

    // Draw the modified video frame on top of the background video
    image(video, 0, 0, width, height);
  }
</script>

</body>
</html>
